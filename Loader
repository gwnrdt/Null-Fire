
-- Services
local Players = game:GetService("Players")
local HttpService = game:GetService("HttpService")
local LocalPlayer = Players.LocalPlayer

-- Environments
local genv = getgenv()
local fenv = getfenv()

-- Mark hub as loaded
genv.FireHubLoaded = true

-- Helper functions
fenv.urlGet = function(url)
    return game:HttpGet(url, true)
end

fenv.urlLoad = function(url, ...)
    local src = game:HttpGet(url, true)
    return loadstring(src)(...)
end

-- Load Fire Library
local FireLibSource = game:HttpGet(
    "https://raw.githubusercontent.com/gwnrdt/Null-Fire/refs/heads/main/Core/Libraries/Fire-Lib/Main.lua",
    true
)
local FireLib = loadstring(FireLibSource)()

-- Notify start
FireLib.Notifications:Notification({
    Title = "NullFire Initialization",
    Text = "NullFire Initialization begun!\nDoing base checks & loading data..."
})

-- Load Personal Player Data
local playerDataSource = game:HttpGet(
    "https://raw.githubusercontent.com/gwnrdt/Null-Fire/refs/heads/main/Core/Data/PersonalPlayerData.json",
    true
)
local playerData = HttpService:JSONDecode(playerDataSource)
genv.PersonalPlayerData = playerData

-- Admin check
local userId = tostring(LocalPlayer.UserId)
if playerData[userId] and playerData[userId].Admin then
    FireLib.Notifications:Notification({
        Title = "NullFire Initialization",
        Text = "Ooh, you're an admin, cool!"
    })
end

-- Load supported games list
FireLib.Notifications:Notification({
    Title = "NullFire Initialization",
    Text = "Searching for the game..."
})

local supportedSource = game:HttpGet(
    "https://raw.githubusercontent.com/InfernusScripts/Null-Fire/main/Core/Data/SupportedGames.json",
    true
)
local supportedGames = HttpService:JSONDecode(supportedSource)

-- Find matching game & load it
for gameName, placeIds in pairs(supportedGames) do
    if table.find(placeIds, game.PlaceId) then
        genv.GameName = gameName

        local loaderUrl =
            "https://raw.githubusercontent.com/InfernusScripts/Null-Fire/main/Core/Loaders/"
            .. gameName .. "/Main.lua"

        FireLib.Notifications:Notification({
            Title = "NullFire Initialization",
            Text = "Initialization done!\nLoading script for: "
                .. gameName .. "\n\n(" .. loaderUrl .. ")"
        })

        local gameLoader = game:HttpGet(loaderUrl, true)
        loadstring(gameLoader)()
        return
    end
end
